/* global WebGLImageFilter */

'use strict';

document.addEventListener('DOMContentLoaded', function () {
  (function blurFn() {
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var parentCanvas = canvas.parentElement;
    var btnSave = document.getElementById('save');
    // let btnUpload = document.getElementById('upload');
    var btnReset = document.getElementById('reset');
    var wrapImg = document.getElementById('box-img');
    var wrapArrows = document.querySelector('.list-arrow');
    var rect = {};
    var drag = false;
    var img = null;
    var src = '../img/чек-mini.jpg';
    var imgData, filteredImage, rw, rh;

    ctx.textAlign = 'center';
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.fillText('Loading...', canvas.width / 2, canvas.height / 2);

    try {
      img = new Image();
      var filter = new WebGLImageFilter();

      img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
      };

      img.src = src;

      canvas.ondragstart = function () {
        return false;
      };

      if ('ontouchstart' in window || navigator.msMaxTouchPoints) alert('It a touch screen device.');else
      alert('Others devices');


      var blurMove = function blurMove(e) {
        if (drag) {
          if ('ontouchstart' in window || navigator.msMaxTouchPoints) {
            e.preventDefault();
            rect.w = e.changedTouches[0].pageX - this.offsetLeft + this.parentNode.scrollLeft - rect.startX;
            rect.h = e.changedTouches[0].pageY - this.offsetTop + this.parentNode.scrollTop - rect.startY;
          } else {
            rect.w = e.pageX - this.offsetLeft + this.parentNode.scrollLeft - rect.startX;
            rect.h = e.pageY - this.offsetTop + this.parentNode.scrollTop - rect.startY;
          }
          if (rect.w === 0 || rect.h === 0) return;
          filter.reset();
          filter.addFilter('blur', 50);
          filteredImage = filter.apply(img);
          ctx.drawImage(filteredImage, 0, 0);
          ctx.lineWidth = 1;
          ctx.strokeStyle = 'rgba(0, 0, 0, 0)';

          imgData = ctx.getImageData(rect.startX, rect.startY, rect.w, rect.h);
          filter.reset();
          ctx.drawImage(img, 0, 0);
          if (rect.w < 0) rw = rect.startX + rect.w;else
          rw = rect.startX;
          if (rect.h < 0) rh = rect.startY + rect.h;else
          rh = rect.startY;
          ctx.putImageData(imgData, rw, rh);
          ctx.strokeRect(rect.startX, rect.startY, rect.w, rect.h);
        }
      };

      var startBlur = function startBlur(e) {
        if ('ontouchstart' in window || navigator.msMaxTouchPoints) {
          e.preventDefault();
          rect.startX = e.changedTouches[0].pageX - this.offsetLeft + this.parentNode.scrollLeft;
          rect.startY = e.changedTouches[0].pageY - this.offsetTop + this.parentNode.scrollTop;
        } else {
          rect.startX = e.pageX - this.offsetLeft + this.parentNode.scrollLeft;
          rect.startY = e.pageY - this.offsetTop + this.parentNode.scrollTop;
        }
        drag = true;
      };

      var endBlur = function endBlur() {
        img.src = canvas.toDataURL();
        drag = false;
      };

      var saveImg = function saveImg() {
        var newImg = new Image();
        var oldImg = wrapImg.getElementsByTagName('img')[0];

        if (oldImg != undefined) wrapImg.removeChild(oldImg);
        newImg.src = canvas.toDataURL();
        wrapImg.appendChild(newImg);
      };

      var startReset = function startReset() {
        img.src = src;
        ctx.drawImage(img, 0, 0);
      };

      var scrollTo = function scrollTo(e) {
        e.preventDefault();
        var target = e.target;

        while (target != wrapArrows) {

          switch (target.id) {
            case 'left':
              parentCanvas.scrollLeft += 50;
              return;
            case 'right':
              parentCanvas.scrollLeft -= 50;
              return;
            case 'bottom':
              parentCanvas.scrollTop += 50;
              return;
            case 'top':
              parentCanvas.scrollTop -= 50;
              return;}

        }

        target = target.parentNode;
      };

      canvas.addEventListener('mousedown', startBlur, false);
      canvas.addEventListener('touchstart', startBlur, false);
      canvas.addEventListener('mouseup', endBlur, false);
      canvas.addEventListener('touchend', endBlur, false);
      canvas.addEventListener('mouseout', endBlur, false);
      canvas.addEventListener('mousemove', blurMove, false);
      canvas.addEventListener('touchmove', blurMove, false);
      btnReset.addEventListener('click', startReset, false);
      btnSave.addEventListener('click', saveImg, false);
      wrapArrows.addEventListener('click', scrollTo, false);

    } catch (err) {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.fillText('This browser doesn\'t support WebGL', canvas.width / 2, canvas.height / 2);
      console.log(err);
    }
  })();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJibHVyRm4iLCJjYW52YXMiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJwYXJlbnRDYW52YXMiLCJwYXJlbnRFbGVtZW50IiwiYnRuU2F2ZSIsImJ0blJlc2V0Iiwid3JhcEltZyIsIndyYXBBcnJvd3MiLCJxdWVyeVNlbGVjdG9yIiwicmVjdCIsImRyYWciLCJpbWciLCJzcmMiLCJpbWdEYXRhIiwiZmlsdGVyZWRJbWFnZSIsInJ3IiwicmgiLCJ0ZXh0QWxpZ24iLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsIndpZHRoIiwiaGVpZ2h0IiwiZmlsbFRleHQiLCJJbWFnZSIsImZpbHRlciIsIldlYkdMSW1hZ2VGaWx0ZXIiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJvbmRyYWdzdGFydCIsIndpbmRvdyIsIm5hdmlnYXRvciIsIm1zTWF4VG91Y2hQb2ludHMiLCJhbGVydCIsImJsdXJNb3ZlIiwiZSIsInByZXZlbnREZWZhdWx0IiwidyIsImNoYW5nZWRUb3VjaGVzIiwicGFnZVgiLCJvZmZzZXRMZWZ0IiwicGFyZW50Tm9kZSIsInNjcm9sbExlZnQiLCJzdGFydFgiLCJoIiwicGFnZVkiLCJvZmZzZXRUb3AiLCJzY3JvbGxUb3AiLCJzdGFydFkiLCJyZXNldCIsImFkZEZpbHRlciIsImFwcGx5IiwibGluZVdpZHRoIiwic3Ryb2tlU3R5bGUiLCJnZXRJbWFnZURhdGEiLCJwdXRJbWFnZURhdGEiLCJzdHJva2VSZWN0Iiwic3RhcnRCbHVyIiwiZW5kQmx1ciIsInRvRGF0YVVSTCIsInNhdmVJbWciLCJuZXdJbWciLCJvbGRJbWciLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInVuZGVmaW5lZCIsInJlbW92ZUNoaWxkIiwiYXBwZW5kQ2hpbGQiLCJzdGFydFJlc2V0Iiwic2Nyb2xsVG8iLCJ0YXJnZXQiLCJpZCIsImVyciIsImNvbnNvbGUiLCJsb2ci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RUFBNkMsS0FBN0M7QUFDQTNELE1BQUFBLE1BQU0sQ0FBQ0YsZ0JBQVAsQ0FBd0IsVUFBeEIsRUFBb0M2RCxPQUFwQyxFQUE2QyxLQUE3QztBQUNBM0QsTUFBQUEsTUFBTSxDQUFDRixnQkFBUCxDQUF3QixXQUF4QixFQUFxQ3FDLFFBQXJDLEVBQStDLEtBQS9DO0FBQ0FuQyxNQUFBQSxNQUFNLENBQUNGLGdCQUFQLENBQXdCLFdBQXhCLEVBQXFDcUMsUUFBckMsRUFBK0MsS0FBL0M7QUFDQTVCLE1BQUFBLFFBQVEsQ0FBQ1QsZ0JBQVQsQ0FBMEIsT0FBMUIsRUFBbUNzRSxVQUFuQyxFQUErQyxLQUEvQztBQUNBOUQsTUFBQUEsT0FBTyxDQUFDUixnQkFBUixDQUF5QixPQUF6QixFQUFrQytELE9BQWxDLEVBQTJDLEtBQTNDO0FBQ0FwRCxNQUFBQSxVQUFVLENBQUNYLGdCQUFYLENBQTRCLE9BQTVCLEVBQXFDdUUsUUFBckMsRUFBK0MsS0FBL0M7O0FBRUEsS0FySEQsQ0FxSEUsT0FBTUcsR0FBTixFQUFXO0FBQ1p0RSxNQUFBQSxHQUFHLENBQUNrQixTQUFKLEdBQWdCLE1BQWhCO0FBQ0FsQixNQUFBQSxHQUFHLENBQUNtQixRQUFKLENBQWEsQ0FBYixFQUFnQixDQUFoQixFQUFtQnJCLE1BQU0sQ0FBQ3NCLEtBQTFCLEVBQWlDdEIsTUFBTSxDQUFDdUIsTUFBeEM7QUFDQXJCLE1BQUFBLEdBQUcsQ0FBQ2tCLFNBQUosR0FBZ0IsTUFBaEI7QUFDQWxCLE1BQUFBLEdBQUcsQ0FBQ3NCLFFBQUosQ0FBYSxxQ0FBYixFQUFvRHhCLE1BQU0sQ0FBQ3NCLEtBQVAsR0FBZSxDQUFuRSxFQUFzRXRCLE1BQU0sQ0FBQ3VCLE1BQVAsR0FBZ0IsQ0FBdEY7QUFDQWtELE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixHQUFaO0FBQ0E7QUFDRCxHQWpKRDtBQWtKQSxDQW5KRCIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBXZWJHTEltYWdlRmlsdGVyICovXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcblx0KGZ1bmN0aW9uIGJsdXJGbigpIHtcclxuXHRcdGxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJyk7XHJcblx0XHRsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcblx0XHRsZXQgcGFyZW50Q2FudmFzID0gY2FudmFzLnBhcmVudEVsZW1lbnQ7XHJcblx0XHRsZXQgYnRuU2F2ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlJyk7XHJcblx0XHQvLyBsZXQgYnRuVXBsb2FkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZCcpO1xyXG5cdFx0bGV0IGJ0blJlc2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0Jyk7XHJcblx0XHRsZXQgd3JhcEltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3gtaW1nJyk7XHJcblx0XHRsZXQgd3JhcEFycm93cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0LWFycm93Jyk7XHJcblx0XHRjb25zdCByZWN0ID0ge307XHJcblx0XHRsZXQgZHJhZyA9IGZhbHNlO1xyXG5cdFx0bGV0IGltZyA9IG51bGw7XHJcblx0XHRsZXQgc3JjID0gJy4uL2ltZy/Rh9C10LotbWluaS5qcGcnO1xyXG5cdFx0bGV0IGltZ0RhdGEsIGZpbHRlcmVkSW1hZ2UsIHJ3LCByaDtcclxuXHJcblx0XHRjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcblx0XHRjdHguZmlsbFN0eWxlID0gJyMwMDAnO1xyXG5cdFx0Y3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblx0XHRjdHguZmlsbFN0eWxlID0gJyNmZmYnO1xyXG5cdFx0Y3R4LmZpbGxUZXh0KCdMb2FkaW5nLi4uJywgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDIpO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdFx0XHRsZXQgZmlsdGVyID0gbmV3IFdlYkdMSW1hZ2VGaWx0ZXIoKTtcclxuXHJcblx0XHRcdGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XHJcblx0XHRcdFx0Y2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XHJcblx0XHRcdFx0Y3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0aW1nLnNyYyA9IHNyYztcclxuXHJcblx0XHRcdGNhbnZhcy5vbmRyYWdzdGFydCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cgfHwgbmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMpIGFsZXJ0KCdJdCBhIHRvdWNoIHNjcmVlbiBkZXZpY2UuJyk7XHJcblx0XHRcdGVsc2UgYWxlcnQoJ090aGVycyBkZXZpY2VzJyk7XHJcblxyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgYmx1ck1vdmUgPSBmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0aWYgKGRyYWcpIHtcclxuXHRcdFx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cgfHwgbmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMpIHtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRyZWN0LncgPSAoZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIHRoaXMub2Zmc2V0TGVmdCArIHRoaXMucGFyZW50Tm9kZS5zY3JvbGxMZWZ0KSAtIHJlY3Quc3RhcnRYO1xyXG5cdFx0XHRcdFx0XHRyZWN0LmggPSAoZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSAtIHRoaXMub2Zmc2V0VG9wICsgdGhpcy5wYXJlbnROb2RlLnNjcm9sbFRvcCkgLSByZWN0LnN0YXJ0WTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHJlY3QudyA9IChlLnBhZ2VYICAtIHRoaXMub2Zmc2V0TGVmdCArIHRoaXMucGFyZW50Tm9kZS5zY3JvbGxMZWZ0KSAtIHJlY3Quc3RhcnRYO1xyXG5cdFx0XHRcdFx0XHRyZWN0LmggPSAoZS5wYWdlWSAgLSB0aGlzLm9mZnNldFRvcCArIHRoaXMucGFyZW50Tm9kZS5zY3JvbGxUb3ApIC0gcmVjdC5zdGFydFk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAocmVjdC53ID09PSAwIHx8IHJlY3QuaCA9PT0gMCkgcmV0dXJuO1xyXG5cdFx0XHRcdFx0ZmlsdGVyLnJlc2V0KCk7XHJcblx0XHRcdFx0XHRmaWx0ZXIuYWRkRmlsdGVyKCdibHVyJywgNTApO1xyXG5cdFx0XHRcdFx0ZmlsdGVyZWRJbWFnZSA9IGZpbHRlci5hcHBseShpbWcpO1xyXG5cdFx0XHRcdFx0Y3R4LmRyYXdJbWFnZShmaWx0ZXJlZEltYWdlLCAwLCAwKTtcclxuXHRcdFx0XHRcdGN0eC5saW5lV2lkdGggPSAxO1xyXG5cdFx0XHRcdFx0Y3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMCwgMCwgMCwgMCknO1xyXG5cclxuXHRcdFx0XHRcdGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKHJlY3Quc3RhcnRYLCByZWN0LnN0YXJ0WSwgcmVjdC53LCByZWN0LmgpO1xyXG5cdFx0XHRcdFx0ZmlsdGVyLnJlc2V0KCk7XHJcblx0XHRcdFx0XHRjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcblx0XHRcdFx0XHRpZiAocmVjdC53IDwgMCkgcncgPSByZWN0LnN0YXJ0WCArIHJlY3QudzsgXHJcblx0XHRcdFx0XHRlbHNlIHJ3ID0gcmVjdC5zdGFydFg7XHJcblx0XHRcdFx0XHRpZiAocmVjdC5oIDwgMCkgcmggPSByZWN0LnN0YXJ0WSArIHJlY3QuaDtcclxuXHRcdFx0XHRcdGVsc2UgcmggPSByZWN0LnN0YXJ0WTtcclxuXHRcdFx0XHRcdGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgcncsIHJoKTtcclxuXHRcdFx0XHRcdGN0eC5zdHJva2VSZWN0KHJlY3Quc3RhcnRYLCByZWN0LnN0YXJ0WSwgcmVjdC53LCByZWN0LmgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGNvbnN0IHN0YXJ0Qmx1ciA9IGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRpZiAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93IHx8IG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzKSB7XHJcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRyZWN0LnN0YXJ0WCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggLSB0aGlzLm9mZnNldExlZnQgKyB0aGlzLnBhcmVudE5vZGUuc2Nyb2xsTGVmdDtcclxuXHRcdFx0XHRcdHJlY3Quc3RhcnRZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSAtIHRoaXMub2Zmc2V0VG9wICsgdGhpcy5wYXJlbnROb2RlLnNjcm9sbFRvcDtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0cmVjdC5zdGFydFggPSBlLnBhZ2VYICAtIHRoaXMub2Zmc2V0TGVmdCArIHRoaXMucGFyZW50Tm9kZS5zY3JvbGxMZWZ0O1xyXG5cdFx0XHRcdFx0cmVjdC5zdGFydFkgPSBlLnBhZ2VZICAtIHRoaXMub2Zmc2V0VG9wICsgdGhpcy5wYXJlbnROb2RlLnNjcm9sbFRvcDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZHJhZyA9IHRydWU7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRjb25zdCBlbmRCbHVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0aW1nLnNyYyA9IGNhbnZhcy50b0RhdGFVUkwoKTtcclxuXHRcdFx0XHRkcmFnID0gZmFsc2U7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRjb25zdCBzYXZlSW1nID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0bGV0IG5ld0ltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdFx0XHRcdGxldCBvbGRJbWcgPSB3cmFwSW1nLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWcnKVswXTtcclxuXHJcblx0XHRcdFx0aWYgKG9sZEltZyAhPSB1bmRlZmluZWQpIHdyYXBJbWcucmVtb3ZlQ2hpbGQob2xkSW1nKTtcclxuXHRcdFx0XHRuZXdJbWcuc3JjID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG5cdFx0XHRcdHdyYXBJbWcuYXBwZW5kQ2hpbGQobmV3SW1nKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGNvbnN0IHN0YXJ0UmVzZXQgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRpbWcuc3JjID0gc3JjO1xyXG5cdFx0XHRcdGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGNvbnN0IHNjcm9sbFRvID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XHJcblxyXG5cdFx0XHRcdHdoaWxlKHRhcmdldCAhPSB3cmFwQXJyb3dzKSB7XHJcblxyXG5cdFx0XHRcdFx0c3dpdGNoICh0YXJnZXQuaWQpIHtcclxuXHRcdFx0XHRcdGNhc2UgJ2xlZnQnOlxyXG5cdFx0XHRcdFx0XHRwYXJlbnRDYW52YXMuc2Nyb2xsTGVmdCArPSA1MDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0Y2FzZSAncmlnaHQnOlxyXG5cdFx0XHRcdFx0XHRwYXJlbnRDYW52YXMuc2Nyb2xsTGVmdCAtPSA1MDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0Y2FzZSAnYm90dG9tJzpcclxuXHRcdFx0XHRcdFx0cGFyZW50Q2FudmFzLnNjcm9sbFRvcCArPSA1MDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0Y2FzZSAndG9wJzpcclxuXHRcdFx0XHRcdFx0cGFyZW50Q2FudmFzLnNjcm9sbFRvcCAtPSA1MDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgc3RhcnRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgc3RhcnRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZW5kQmx1ciwgZmFsc2UpO1xyXG5cdFx0XHRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBlbmRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIGVuZEJsdXIsIGZhbHNlKTtcclxuXHRcdFx0Y2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGJsdXJNb3ZlLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBibHVyTW92ZSwgZmFsc2UpO1xyXG5cdFx0XHRidG5SZXNldC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0YXJ0UmVzZXQsIGZhbHNlKTtcclxuXHRcdFx0YnRuU2F2ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNhdmVJbWcsIGZhbHNlKTtcclxuXHRcdFx0d3JhcEFycm93cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNjcm9sbFRvLCBmYWxzZSk7XHJcblxyXG5cdFx0fSBjYXRjaChlcnIpIHtcclxuXHRcdFx0Y3R4LmZpbGxTdHlsZSA9ICcjMDAwJztcclxuXHRcdFx0Y3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblx0XHRcdGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7XHJcblx0XHRcdGN0eC5maWxsVGV4dCgnVGhpcyBicm93c2VyIGRvZXNuXFwndCBzdXBwb3J0IFdlYkdMJywgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDIpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xyXG5cdFx0fVxyXG5cdH0pICgpO1xyXG59KTsiXSwiZmlsZSI6InNjcmlwdC5qcyJ9
