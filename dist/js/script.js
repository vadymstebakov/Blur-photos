/* global WebGLImageFilter */

'use strict';

document.addEventListener('DOMContentLoaded', function () {
  (function blurFn() {
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var btnSave = document.getElementById('save');
    // let btnUpload = document.getElementById('upload');
    var btnReset = document.getElementById('reset');
    var wrapImg = document.getElementById('box-img');
    var rect = {};
    var drag = false;
    var img = null;
    var imgData, filteredImage, rw, rh;

    ctx.textAlign = 'center';
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.fillText('Loading...', canvas.width / 2, canvas.height / 2);

    try {
      img = new Image();
      var filter = new WebGLImageFilter();

      img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
      };

      img.src = '../img/чек-mini.jpg';

      canvas.ondragstart = function () {
        return false;
      };

      if ('ontouchstart' in document.documentElement) alert('It a touch screen device.');else
      alert('Others devices');


      var blurMove = function blurMove(e) {
        if (drag) {
          if ('ontouchstart' in document.documentElement) {
            rect.w = e.changedTouches[0].pageX - this.offsetLeft - rect.startX;
            rect.h = e.changedTouches[0].pageY - this.offsetTop - rect.startY;
          } else {
            rect.w = e.pageX - this.offsetLeft - rect.startX;
            rect.h = e.pageY - this.offsetTop - rect.startY;
          }
          if (rect.w === 0 || rect.h === 0) return;
          filter.reset();
          filter.addFilter('blur', 20);
          filteredImage = filter.apply(img);
          ctx.drawImage(filteredImage, 0, 0);
          ctx.lineWidth = 1;
          ctx.strokeStyle = 'rgba(0, 0, 0, 0)';

          imgData = ctx.getImageData(rect.startX, rect.startY, rect.w, rect.h);
          filter.reset();
          ctx.drawImage(img, 0, 0);
          if (rect.w < 0) rw = rect.startX + rect.w;else
          rw = rect.startX;
          if (rect.h < 0) rh = rect.startY + rect.h;else
          rh = rect.startY;
          ctx.putImageData(imgData, rw, rh);
          ctx.strokeRect(rect.startX, rect.startY, rect.w, rect.h);
        }
      };

      var startBlur = function startBlur(e) {
        if ('ontouchstart' in document.documentElement) {
          rect.startX = e.changedTouches[0].pageX - this.offsetLeft;
          rect.startY = e.changedTouches[0].pageY - this.offsetTop;
        } else {
          rect.startX = e.pageX - this.offsetLeft;
          rect.startY = e.pageY - this.offsetTop;
        }
        drag = true;
      };

      var endBlur = function endBlur() {
        drag = false;
      };

      var saveImg = function saveImg() {
        var newImg = new Image();
        newImg.src = canvas.toDataURL();
        wrapImg.appendChild(newImg);
      };

      var startReset = function startReset() {
        filter.reset();
        ctx.drawImage(img, 0, 0);
      };

      canvas.addEventListener('mousedown', startBlur, false);
      canvas.addEventListener('touchstart', startBlur, false);
      canvas.addEventListener('mouseup', endBlur, false);
      canvas.addEventListener('mouseout', endBlur, false);
      canvas.addEventListener('mousemove', blurMove, false);
      canvas.addEventListener('touchmove', blurMove, false);
      btnReset.addEventListener('click', startReset, false);

    } catch (err) {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.fillText('This browser doesn\'t support WebGL', canvas.width / 2, canvas.height / 2);
      console.log(err);
    }
  })();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJibHVyRm4iLCJjYW52YXMiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJidG5TYXZlIiwiYnRuUmVzZXQiLCJ3cmFwSW1nIiwicmVjdCIsImRyYWciLCJpbWciLCJpbWdEYXRhIiwiZmlsdGVyZWRJbWFnZSIsInJ3IiwicmgiLCJ0ZXh0QWxpZ24iLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsIndpZHRoIiwiaGVpZ2h0IiwiZmlsbFRleHQiLCJJbWFnZSIsImZpbHRlciIsIldlYkdMSW1hZ2VGaWx0ZXIiLCJvbmxvYWQiLCJkcmF3SW1hZ2UiLCJzcmMiLCJvbmRyYWdzdGFydCIsImRvY3VtZW50RWxlbWVudCIsImFsZXJ0IiwiYmx1ck1vdmUiLCJlIiwidyIsImNoYW5nZWRUb3VjaGVzIiwicGFnZVgiLCJvZmZzZXRMZWZ0Iiwic3RhcnRYIiwiaCIsInBhZ2VZIiwib2Zmc2V0VG9wIiwic3RhcnRZIiwicmVzZXQiLCJhZGRGaWx0ZXIiLCJhcHBseSIsImxpbmVXaWR0aCIsInN0cm9rZVN0eWxlIiwiZ2V0SW1hZ2VEYXRhIiwicHV0SW1hZ2VEYXRhIiwic3Ryb2tlUmVjdCIsInN0YXJ0Qmx1ciIsImVuZEJsdXIiLCJzYXZlSW1nIiwibmV3SW1nIiwidG9EYXRhVVJMIiwiYXBwZW5kQ2hpbGQiLCJzdGFydFJlc2V0IiwiZXJyIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7O0FBRUFBLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLFlBQVc7QUFDeEQsR0FBQyxTQUFTQyxNQUFULEdBQWtCO0FBQ2xCLFFBQUlDLE1BQU0sR0FBR0gsUUFBUSxDQUFDSSxjQUFULENBQXdCLFFBQXhCLENBQWI7QUFDQSxRQUFJQyxHQUFHLEdBQUdGLE1BQU0sQ0FBQ0csVUFBUCxDQUFrQixJQUFsQixDQUFWO0FBQ0EsUUFB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LEdBQWUsQ0FBbkUsRUFBc0VqQixNQUFNLENBQUNrQixNQUFQLEdBQWdCLENBQXRGO0FBQ0FzQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsR0FBWjtBQUNBO0FBQ0QsR0E1R0Q7QUE2R0EsQ0E5R0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgV2ViR0xJbWFnZUZpbHRlciAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG5cdChmdW5jdGlvbiBibHVyRm4oKSB7XHJcblx0XHRsZXQgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xyXG5cdFx0bGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG5cdFx0bGV0IGJ0blNhdmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZScpO1xyXG5cdFx0Ly8gbGV0IGJ0blVwbG9hZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQnKTtcclxuXHRcdGxldCBidG5SZXNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldCcpO1xyXG5cdFx0bGV0IHdyYXBJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm94LWltZycpO1xyXG5cdFx0Y29uc3QgcmVjdCA9IHt9O1xyXG5cdFx0bGV0IGRyYWcgPSBmYWxzZTtcclxuXHRcdGxldCBpbWcgPSBudWxsO1xyXG5cdFx0bGV0IGltZ0RhdGEsIGZpbHRlcmVkSW1hZ2UsIHJ3LCByaDtcclxuXHJcblx0XHRjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcblx0XHRjdHguZmlsbFN0eWxlID0gJyMwMDAnO1xyXG5cdFx0Y3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblx0XHRjdHguZmlsbFN0eWxlID0gJyNmZmYnO1xyXG5cdFx0Y3R4LmZpbGxUZXh0KCdMb2FkaW5nLi4uJywgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDIpO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGltZyA9IG5ldyBJbWFnZSgpO1xyXG5cdFx0XHRsZXQgZmlsdGVyID0gbmV3IFdlYkdMSW1hZ2VGaWx0ZXIoKTtcclxuXHJcblx0XHRcdGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XHJcblx0XHRcdFx0Y2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XHJcblx0XHRcdFx0Y3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0aW1nLnNyYyA9ICcuLi9pbWcv0YfQtdC6LW1pbmkuanBnJztcclxuXHJcblx0XHRcdGNhbnZhcy5vbmRyYWdzdGFydCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIGFsZXJ0KCdJdCBhIHRvdWNoIHNjcmVlbiBkZXZpY2UuJyk7XHJcblx0XHRcdGVsc2UgYWxlcnQoJ090aGVycyBkZXZpY2VzJyk7XHJcblxyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgYmx1ck1vdmUgPSBmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0aWYgKGRyYWcpIHtcclxuXHRcdFx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcclxuXHRcdFx0XHRcdFx0cmVjdC53ID0gKGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggLSB0aGlzLm9mZnNldExlZnQpIC0gcmVjdC5zdGFydFg7XHJcblx0XHRcdFx0XHRcdHJlY3QuaCA9IChlLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gdGhpcy5vZmZzZXRUb3ApIC0gcmVjdC5zdGFydFk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRyZWN0LncgPSAoZS5wYWdlWCAtIHRoaXMub2Zmc2V0TGVmdCkgLSByZWN0LnN0YXJ0WDtcclxuXHRcdFx0XHRcdFx0cmVjdC5oID0gKGUucGFnZVkgLSB0aGlzLm9mZnNldFRvcCkgLSByZWN0LnN0YXJ0WTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChyZWN0LncgPT09IDAgfHwgcmVjdC5oID09PSAwKSByZXR1cm47XHJcblx0XHRcdFx0XHRmaWx0ZXIucmVzZXQoKTtcclxuXHRcdFx0XHRcdGZpbHRlci5hZGRGaWx0ZXIoJ2JsdXInLCAyMCk7XHJcblx0XHRcdFx0XHRmaWx0ZXJlZEltYWdlID0gZmlsdGVyLmFwcGx5KGltZyk7XHJcblx0XHRcdFx0XHRjdHguZHJhd0ltYWdlKGZpbHRlcmVkSW1hZ2UsIDAsIDApO1xyXG5cdFx0XHRcdFx0Y3R4LmxpbmVXaWR0aCA9IDE7XHJcblx0XHRcdFx0XHRjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLCAwLCAwLCAwKSc7XHJcblxyXG5cdFx0XHRcdFx0aW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEocmVjdC5zdGFydFgsIHJlY3Quc3RhcnRZLCByZWN0LncsIHJlY3QuaCk7XHJcblx0XHRcdFx0XHRmaWx0ZXIucmVzZXQoKTtcclxuXHRcdFx0XHRcdGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuXHRcdFx0XHRcdGlmIChyZWN0LncgPCAwKSBydyA9IHJlY3Quc3RhcnRYICsgcmVjdC53OyBcclxuXHRcdFx0XHRcdGVsc2UgcncgPSByZWN0LnN0YXJ0WDtcclxuXHRcdFx0XHRcdGlmIChyZWN0LmggPCAwKSByaCA9IHJlY3Quc3RhcnRZICsgcmVjdC5oO1xyXG5cdFx0XHRcdFx0ZWxzZSByaCA9IHJlY3Quc3RhcnRZO1xyXG5cdFx0XHRcdFx0Y3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCBydywgcmgpO1xyXG5cdFx0XHRcdFx0Y3R4LnN0cm9rZVJlY3QocmVjdC5zdGFydFgsIHJlY3Quc3RhcnRZLCByZWN0LncsIHJlY3QuaCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Y29uc3Qgc3RhcnRCbHVyID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcclxuXHRcdFx0XHRcdHJlY3Quc3RhcnRYID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIHRoaXMub2Zmc2V0TGVmdDtcclxuXHRcdFx0XHRcdHJlY3Quc3RhcnRZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSAtIHRoaXMub2Zmc2V0VG9wO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZWN0LnN0YXJ0WCA9IGUucGFnZVggLSB0aGlzLm9mZnNldExlZnQ7XHJcblx0XHRcdFx0XHRyZWN0LnN0YXJ0WSA9IGUucGFnZVkgLSB0aGlzLm9mZnNldFRvcDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZHJhZyA9IHRydWU7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRjb25zdCBlbmRCbHVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0ZHJhZyA9IGZhbHNlO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Y29uc3Qgc2F2ZUltZyA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGxldCBuZXdJbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRcdFx0XHRuZXdJbWcuc3JjID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG5cdFx0XHRcdHdyYXBJbWcuYXBwZW5kQ2hpbGQobmV3SW1nKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdGNvbnN0IHN0YXJ0UmVzZXQgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRmaWx0ZXIucmVzZXQoKTtcclxuXHRcdFx0XHRjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgc3RhcnRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgc3RhcnRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZW5kQmx1ciwgZmFsc2UpO1xyXG5cdFx0XHRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBlbmRCbHVyLCBmYWxzZSk7XHJcblx0XHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBibHVyTW92ZSwgZmFsc2UpO1xyXG5cdFx0XHRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgYmx1ck1vdmUsIGZhbHNlKTtcclxuXHRcdFx0YnRuUmVzZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdGFydFJlc2V0LCBmYWxzZSk7XHJcblxyXG5cdFx0fSBjYXRjaChlcnIpIHtcclxuXHRcdFx0Y3R4LmZpbGxTdHlsZSA9ICcjMDAwJztcclxuXHRcdFx0Y3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcblx0XHRcdGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7XHJcblx0XHRcdGN0eC5maWxsVGV4dCgnVGhpcyBicm93c2VyIGRvZXNuXFwndCBzdXBwb3J0IFdlYkdMJywgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDIpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xyXG5cdFx0fVxyXG5cdH0pICgpO1xyXG59KTsiXSwiZmlsZSI6InNjcmlwdC5qcyJ9
